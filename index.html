<!doctype html>
<html>
<head>
	<title>Seyfor Screen</title>
	<style>

	@keyframes spinloop {
		  0%   { transform: rotate(0deg); }
		  40% { transform: rotate(180deg); }
		  60% { transform: rotate(180deg); }
		  100% { transform: rotate(0deg); }
		}


		html {
			background: url('img/background.jpg') no-repeat center center fixed;
			background-size: 100% 100%;
		}

		#content {
			position: fixed;
		    top: 0;
		    bottom: 0;
		    left: 20%;
		    right: 20%;
		    background-color: rgba(0,76,107,0.7);
		}	

		.diamond{
			transform: rotate(45deg);
		}

		.diamond-content {
			transform: rotate(-45deg);
		}


	</style>
</head>
<body>
	<div id="content">
		<div id="home" class="hideable">
			<div class="diamond size-adjust" style="position: fixed;width: 25%;background-color: rgba(255,255,255,0.75);left: 37%;top: 22%;">
				<div class="diamond-content" style="">
					<img src="img/logo.png" style="width: 90%;height: 100%;margin-top: 22%;">
				</div>
				<div class="size-adjust" style="position: absolute;width: 50%;left: 107%;top: 0;background-color: rgba(255,255,255,0.75);">
					<div style="transform: rotate(-45deg);text-align: center;">
						<h2 id="clock" style="font-size: 5vw;margin-left: 8%;margin-top: 28%;color: rgba(0,76,107,1)">00:00</h2>
					</div>
				</div>

				<div class="size-adjust" style="position: absolute;width: 50%;right: 107%;bottom: 0;background-color: rgba(255,255,255,0.75);">
				
				</div>

				<div class="size-adjust" style="position: absolute;width: 20%;right: 107%;bottom: 57%;background-color: rgba(255,255,255,0.75);animation: spinloop 10s infinite;">
				
				</div>
			</div>
		</div>
		<div id="abouttostart" class="hideable" style="display: none;">
			<div class="diamond size-adjust" style="position: fixed;width: 25%;background-color: rgba(255,255,255,0.75);left: 37%;top: 22%;">
				<div class="diamond-content" style="text-align: center;">
					<h2 style="font-size: 3vw;">En garde!</h2>
					<h1 class="trainingtitle" style="font-size: 4vw;color: rgba(0,76,107,1);text-overflow: ellipsis;white-space: nowrap;overflow: hidden;"></h1>
					<h2 style="font-size: 3vw;">Qui suit...</h2>
				</div>
			</div>
		</div>
		<div id="activeexercise" class="hideable" style="display: none;background-color: rgba(0,76,107,0.75);height: 100%;top: 0;margin-top: 0;color: #ffffff;">
			<div style="padding-top: 5%;">
				<div id="clock2" style="text-align: center;font-size: 6vw;background-color: #ffffff;color: rgb(0,76,107);width: 45%;margin-left: auto;margin-right: auto;margin-top: 0%;">00:00</div>
			</div>
			<h2 class="exercisetitle" style="font-size: 5vw;text-align: center;"></h2>
			<p class="exerciseadvises" style="text-align: center;font-size: 3.5vw;"></p>
		</div>
		<div id="goodjob" class="hideable" style="display: none;">
			<div class="diamond size-adjust" style="position: fixed;width: 25%;background-color: rgba(255,255,255,0.75);left: 37%;top: 22%;">
				<div class="diamond-content" style="text-align: center;">
					<h1 style="font-size: 4vw;color: rgba(0,76,107,1);text-overflow: ellipsis;white-space: nowrap;overflow: hidden;margin-top: 35%;">Bien jou√©!</h1>
				</div>
			</div>
		</div>
	</div>
	<script
	src="https://code.jquery.com/jquery-3.2.1.min.js"
	integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script>
		$('.size-adjust').each(function (index, element){
				$(element).height($(element).width());
			});

		$(window).on('resize orientationChange', function(event) {
		    $('.size-adjust').each(function (index, element){
				$(element).height($(element).width());
			});
		});
		var clock = setInterval(function() {
			$('#clock').text(moment().format('HH:mm'));
		}, 1000);



















		var trainingStartTime = null;
		var x = setInterval(function() {
			if (!trainingStartTime){
				return true;
			}
		  	// Get todays date and time
			var now = new Date();

			// Find the distance between now an the count down date
			var distance = (now - trainingStartTime.getTime())/(1000);
			now.setHours(0,0,0,0);
			now.setSeconds(now.getSeconds() + distance);

			$('#clock2').text(moment(now).format('HH:mm:ss'));
		}, 1000);


		var socket = io('https://fencing-api.herokuapp.com/tv-app');
		socket.on('training started', function (meta){
			startTraining(meta);
			if (meta.activeExercise){
				startExercise(meta.activeExercise);
			}
		});

		socket.on('exercise started', function (exercise){
			startExercise(exercise);
		});

		socket.on('training finished', function (){
			trainingStartTime = null;
			$('.hideable').hide();
			$('#goodjob').show();
			$(window).resize();
			setTimeout(function () {
				$('.hideable').hide();
				$('#home').show();
				$(window).resize();
			},5000);
			$(window).resize();
		});


		function startTraining(meta){
			trainingStartTime = new Date(meta.started);
			console.log(meta);
			$('.trainingtitle').text(meta.training_session.event.name);
			$('.hideable').hide();
			$('#abouttostart').show();
			$(window).resize();
		};

		function startExercise(exercise){
			console.log(exercise);
			$('.exercisetitle').text(exercise.name);
			$('.exerciseadvises').text(exercise.advises);
			$('.hideable').hide();
			$('#activeexercise').show();
			$(window).resize();
		}
	</script>
</body>
</html>